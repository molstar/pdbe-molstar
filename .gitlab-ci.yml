
stages:
  - publish

npm_publish:
  stage: publish
  # only:
  #   - tags
  image: node:20
  script:
    - echo Branch $CI_COMMIT_BRANCH
    - echo Tag $CI_COMMIT_TAG
    # - echo Matches $CI_COMMIT_TAG =~ /v\d+\.\d+\.\d+(-.+)?/
    - node -e 'console.log(JSON.parse(fs.readFileSync("package.json")).version)'
    - PKG_VERSION = $(node -e 'console.log(JSON.parse(fs.readFileSync("package.json")).version)')
    - echo Version $PKG_VERSION
    # - 'sed -nr "s/^ *\"version\": \"(.*)\",$/\1/p" package.json' # escaping needed
    # - npm ci
    # - npm run lint
    # - npm run build
    # - npm pack
    # - npm publish
  # tags:
  #   - pdbekb-shell
  # rules:
  #   - if: $CI_COMMIT_TAG =~ /v\d+\.\d+\.\d+(-.+)?/


# TODO test this in a separate project :)



